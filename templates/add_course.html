{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card p-5 shadow-lg" style="max-width: 700px; width: 100%; background: rgba(255 255 255 / 0.1); backdrop-filter: blur(15px); border-radius: 20px;">
        <div class="d-flex align-items-center mb-4">
            <h2 class="mb-0 me-2" style="font-weight: 700; font-size: 2rem; color: #0b63ce;">📘 Add Course</h2>
            <a href="{{ url_for('dashboard') }}" class="text-decoration-none" style="color: #0bc5ea; font-weight: 600;">← Dashboard</a>
        </div>
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}
            <div class="mb-4">
                {{ form.name.label(class="form-label fw-semibold") }}
                <div class="input-group">
                    <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">📚</span>
                    {{ form.name(class="form-control border-start-0", placeholder="e.g., Data Structures") }}
                </div>
                {% if form.name.errors %}
                    <div class="text-danger small mt-1">{{ form.name.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="row g-3 mb-4">
                {% if user_role != 'faculty' %}
                <div class="col-md-6">
                    {{ form.faculty_id.label(class="form-label fw-semibold") }}
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">🧑‍🏫</span>
                        {{ form.faculty_id(class="form-select border-start-0") }}
                    </div>
                    {% if form.faculty_id.errors %}
                        <div class="text-danger small mt-1">{{ form.faculty_id.errors[0] }}</div>
                    {% endif %}
                </div>
                {% else %}
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Assigned Faculty</label>
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">🧑‍🏫</span>
                        <input type="text" class="form-control border-start-0" value="{{ session.user_name }}" readonly>
                    </div>
                    {{ form.faculty_id(class="d-none") }}
                </div>
                {% endif %}
                <div class="col-md-6">
                    {{ form.classroom_id.label(class="form-label fw-semibold") }}
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">🏫</span>
                        {{ form.classroom_id(class="form-select border-start-0") }}
                    </div>
                    {% if form.classroom_id.errors %}
                        <div class="text-danger small mt-1">{{ form.classroom_id.errors[0] }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    {{ form.department.label(class="form-label fw-semibold") }}
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">🏛️</span>
                        {{ form.department(class="form-select border-start-0") }}
                    </div>
                    {% if form.department.errors %}
                        <div class="text-danger small mt-1">{{ form.department.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    {{ form.year.label(class="form-label fw-semibold") }}
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">📅</span>
                        {{ form.year(class="form-control border-start-0", placeholder="1-4") }}
                    </div>
                    {% if form.year.errors %}
                        <div class="text-danger small mt-1">{{ form.year.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    {{ form.semester.label(class="form-label fw-semibold") }}
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">📊</span>
                        {{ form.semester(class="form-control border-start-0", placeholder="1-8") }}
                    </div>
                    {% if form.semester.errors %}
                        <div class="text-danger small mt-1">{{ form.semester.errors[0] }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="mb-4">
                {{ form.duration.label(class="form-label fw-semibold") }}
                <div class="input-group">
                    <span class="input-group-text bg-white border-end-0" style="border-radius: 0.375rem 0 0 0.375rem;">⏰</span>
                    {{ form.duration(class="form-control border-start-0", placeholder="Duration in hours") }}
                </div>
                {% if form.duration.errors %}
                    <div class="text-danger small mt-1">{{ form.duration.errors[0] }}</div>
                {% endif %}
            </div>
            <button type="submit" class="btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center gap-2" style="font-weight: 700;">
                ➕ Add Course
            </button>
        </form>
    </div>
</div>

<script>
    // Optional: Toast notification for success (requires backend to set flash message)
    document.addEventListener('DOMContentLoaded', () => {
        const flashMessage = "{{ get_flashed_messages(category_filter=['success'])|join(' ') }}";
        if (flashMessage) {
            const toast = document.createElement('div');
            toast.className = 'toast align-items-center text-bg-success border-0 position-fixed top-0 end-0 m-3';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${flashMessage}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            document.body.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    });
</script>
{% endblock %}
