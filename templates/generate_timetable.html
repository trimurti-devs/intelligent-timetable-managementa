{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh; background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);">
    <div class="card p-5 shadow-lg" style="max-width: 700px; width: 100%; background: linear-gradient(180deg, #ffffff 0%, #f9fafb 100%); border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); animation: fadeInUp 0.6s ease forwards;">
        <h2 class="mb-4" style="font-weight: 700; font-size: 2rem; color: #2563eb;">Generate Timetable</h2>
        <p class="mb-4" style="font-weight: 600; color: #3b82f6;">Select department and semester to generate a conflict-free timetable based on current data.</p>
        {% if user_role == 'admin' %}
        <form method="POST" action="{{ url_for('generate') }}" class="mb-5">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="department" class="form-label" style="font-weight: 600; color: #334155;">Department</label>
                    <select name="department" id="department" class="form-select" required>
                        <option value="cse">CSE</option>
                        <option value="ece">ECE</option>
                        <option value="me">ME</option>
                        <option value="ee">EE</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="semester" class="form-label" style="font-weight: 600; color: #334155;">Semester</label>
                    <select name="semester" id="semester" class="form-select" required>
                        {% for i in range(1, 9) %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg px-5 py-3" style="font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;">
                    Generate Timetable
                </button>
            </div>
        </form>
        {% endif %}

        {% if timetable_groups %}
        <h3 class="mb-3" style="font-weight: 700; color: #2563eb;">Generated Timetables</h3>
        {% for (dept, sem), tts in timetable_groups.items() %}
        <h4 class="mb-2" style="color: #2563eb;">{{ dept.upper() }} Semester {{ sem }}</h4>
        <table class="table table-striped shadow-sm rounded mb-3">
            <thead class="table-primary">
                <tr>
                    <th>Day</th>
                    <th>Time</th>
                    <th>Course</th>
                    <th>Faculty</th>
                    <th>Classroom</th>
                    {% if user_role == 'admin' %}
                    <th>Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for tt in tts %}
                <tr>
                    <td>{{ tt.day }}</td>
                    <td>{{ tt.start_time }} - {{ tt.end_time }}</td>
                    <td>{{ tt.course.name }}</td>
                    <td>{{ tt.faculty_obj.name }}</td>
                    <td>{{ tt.classroom_obj.name }}</td>
                    {% if user_role == 'admin' %}
                    <td>
                        <form method="POST" action="{{ url_for('delete_timetable', tt_id=tt.id) }}" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this timetable entry?')">Delete</button>
                        </form>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="mt-3 mb-4">
            <a href="{{ url_for('export_pdf', department=dept, semester=sem) }}" class="btn btn-primary me-3" style="font-weight: 700;">Export to PDF</a>
            <a href="{{ url_for('export_doc', department=dept, semester=sem) }}" class="btn btn-secondary" style="font-weight: 700;">Export to DOC</a>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-center text-muted mt-5" style="font-weight: 600;">No timetable generated yet.</p>
        {% endif %}
    </div>
</div>

<style>
@keyframes fadeInUp {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}
